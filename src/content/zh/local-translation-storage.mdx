---
title: "本地翻译打包模式"
description: "在应用中直接打包翻译资源，以提升可靠性、性能并支持离线使用。"
date: "2025-03-05"
author: "James Park"
tags: ["translations", "architecture", "performance"]
---

在开发阶段，在运行时从远程 CDN 获取翻译很方便，但在生产环境中，将翻译作为本地资源打包进应用通常更有优势。这种模式可以消除对网络的依赖，缩短页面变为可交互的时间，并支持离线使用。

## 为什么要打包翻译资源

想象一下，当你的翻译 CDN 宕机时会发生什么。如果你的应用在运行时依赖它，用户会看到未翻译的内容，或者更糟的是，界面布局被破坏。通过将翻译资源打包进构建产物，你可以彻底消除这一单点故障。

还有一些额外的好处：

- **零延迟** -- 翻译内容可立即使用，无需网络请求。
- **可复现的构建** -- 使用的确切翻译版本会被记录在版本控制中。
- **更简单的基础设施** -- 无需管理 CDN 配置或缓存失效。
- **离线能力** -- 渐进式 Web 应用在没有网络连接时也能正常工作。

## 模式

这个工作流程很简单。在开发过程中，你使用 CLI 工具拉取翻译，并将其写入本地 JSON 文件。这些文件会与源代码一起提交到代码仓库中。

```
project/
  public/
    _gt/
      es.json
      fr.json
      ja.json
      zh.json
  src/
    loadTranslations.ts
```

一个加载函数会根据当前生效的语言环境导入相应的文件：

```typescript
export default async function loadTranslations(locale: string) {
  const translations = await import(`../public/_gt/${locale}.json`);
  return translations.default;
}
```

该函数会在服务端渲染或静态生成时被调用，因此翻译会被直接内嵌到 HTML 输出中。


## 保持译文新鲜

主要的取舍在于必须显式更新译文。当源内容发生变更时，你需要重新运行翻译命令，检查输出结果，并提交更新后的文件。

对很多团队来说，这其实是一个优势。它会形成清晰的审计记录，并防止意外的翻译变更出现在生产环境中。这种工作流程可以很自然地融入 pull request 审查流程。

## 何时使用此模式

对于以下类型的应用，本地存储是理想选择：

- 内容是按发布周期更新，而不是持续更新。
- 可靠性和性能被放在首位。
- 团队希望对生产环境中发布的内容拥有完全控制权。

对于内容变化非常频繁或包含数百种语言环境的应用，混合方案可能更为实用——将最常见的语言环境本地打包，其余则回退到 CDN。